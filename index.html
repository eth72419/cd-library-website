<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Library</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #search { width: 50%; padding: 10px; margin: 10px; }
        .music-item { 
            margin: 15px; 
            padding: 15px; 
            border: 1px solid #ccc; 
            display: flex; 
            flex-direction: column; /* Stack items vertically */
            align-items: center; /* Center content horizontally */
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }
        .album-art { 
            width: 150px; 
            height: 150px; 
            object-fit: cover; 
            margin-bottom: 15px;
        }
        .music-info { 
            text-align: left;
            width: 100%;
        }
        audio { 
            width: 80%; 
            margin-top: 10px; 
        }
        .disc { 
            margin: 10px 0; 
            cursor: pointer; 
            font-weight: bold;
            padding: 5px;
            background-color: #f1f1f1;
            border-radius: 5px;
        }
        .movements { 
            margin-top: 10px;
            display: none; 
            margin-bottom: 20px;
            width: 100%;
            text-align: left;
        }
        .movement-item {
            display: flex; 
            align-items: center;
            margin-bottom: 15px;
        }
        .movement-item audio {
            margin-left: 15px;
            width: 80%; /* Audio player width adjusted */
        }
    </style>
</head>
<body>
    <h1>My Music Library</h1>
    <input type="text" id="search" placeholder="Search by CD name or movement..." onkeyup="searchMusic()">
    <div id="musicList"></div>

    <script>
        const appUrl = 'https://script.google.com/macros/s/AKfycbxEXvVPUJS51gQSB51sAVc_4wqE-GPmLBarxQ4vrDz8k-Q_8AswFiE9Yr0uNZVMy_XyNA/exec';  // Your Google Apps Script Web App URL

        // Function to display music from Google Sheets
        function displayMusic() {
            fetch(appUrl)
                .then(response => response.json())
                .then(data => {
                    const musicList = document.getElementById("musicList");
                    musicList.innerHTML = ''; // Clear previous music list
                    data.forEach(row => {
                        const item = document.createElement('div');
                        item.classList.add('music-item');

                        const discName = row[4]; // Get CD Disc
                        const albumArt = row[3]; // Get album art URL
                        const link = row[2]; // Get general link (Google Drive link for the entire album)
                        
                        // Create collapsible disc section
                        const discSection = document.createElement('div');
                        discSection.classList.add('disc');
                        discSection.innerHTML = `${row[0]} - ${discName}`;

                        // Create a container for movements
                        const movementsContainer = document.createElement('div');
                        movementsContainer.classList.add('movements');
                        
                        // Loop through movements (Track Title and Track URL)
                        let trackCount = 5; // Start from 5th column, as CD Title is in column 0
                        let movementIndex = 1;
                        while (trackCount < row.length) {
                            const trackTitle = row[trackCount];
                            const trackUrl = row[trackCount + 1];
                            if (trackTitle && trackUrl) {
                                const movementItem = document.createElement('div');
                                movementItem.classList.add('movement-item');
                                movementItem.innerHTML = `
                                    <img class="album-art" src="${albumArt}" alt="Album Art">
                                    <div class="music-info">
                                        <h4>${trackTitle}</h4>
                                        <audio controls>
                                            <source src="${trackUrl}" type="audio/mp3">
                                            Your browser does not support the audio element.
                                        </audio>
                                    </div>
                                `;
                                movementsContainer.appendChild(movementItem);
                            }
                            trackCount += 2; // Move to next track (skip two columns, one for title, one for URL)
                            movementIndex++;
                        }

                        // Append the collapsible section with movements
                        discSection.addEventListener('click', () => {
                            const isVisible = movementsContainer.style.display === 'block';
                            movementsContainer.style.display = isVisible ? 'none' : 'block';
                        });

                        item.appendChild(discSection);
                        item.appendChild(movementsContainer);
                        musicList.appendChild(item);
                    });
                })
                .catch(error => {
                    console.error('Error fetching music:', error);
                });
        }

        // Function to search music based on input
        function searchMusic() {
            const query = document.getElementById("search").value.toLowerCase();
            const musicItems = document.querySelectorAll('.music-item');
            musicItems.forEach(item => {
                const title = item.querySelector('.disc').innerText.toLowerCase();
                if (title.includes(query)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Display music when the page loads
        displayMusic();
    </script>
</body>
</html>
