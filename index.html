<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Library</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #search { width: 50%; padding: 10px; margin: 10px; }
        .music-item { margin: 10px; padding: 10px; border: 1px solid #ccc; display: flex; align-items: center; }
        .music-item img { margin-right: 20px; }
        .music-item h3 { cursor: pointer; }
        .movements { padding-left: 20px; }
    </style>
</head>
<body>
    <h1>My Music Library</h1>
    <input type="text" id="search" placeholder="Search by CD name..." onkeyup="searchMusic()">
    <div id="musicList"></div>

    <script>
        const appUrl = 'https://script.google.com/macros/s/AKfycbxEXvVPUJS51gQSB51sAVc_4wqE-GPmLBarxQ4vrDz8k-Q_8AswFiE9Yr0uNZVMy_XyNA/exec';  // Your Google Apps Script Web App URL

        // Function to toggle the visibility of movements in each CD item
        function toggleMovements(musicId) {
            const movementSection = document.getElementById(`movements-${musicId}`);
            movementSection.style.display = movementSection.style.display === 'none' ? 'block' : 'none';
        }

        // Function to display music from Google Sheets with collapsible sections for movements
        function displayMusic() {
            fetch(appUrl)
                .then(response => response.json())
                .then(data => {
                    const musicList = document.getElementById("musicList");
                    musicList.innerHTML = '';
                    data.forEach((row, index) => {
                        const item = document.createElement('div');
                        item.classList.add('music-item');
                        item.id = `music-item-${index}`;

                        // Ensure the URLs are properly added to the audio elements
                        const movementsHTML = row.slice(5).map((movement, i) => {
                            if (i % 2 === 0 && movement) {
                                const movementUrl = row[i + 1];
                                return `<div class="movements"><strong>Movement ${i / 2 + 1}: </strong>${movement}<br>
                                        <audio controls>
                                            <source src="${movementUrl}" type="audio/mp3">
                                            Your browser does not support the audio element.
                                        </audio></div><br>`;
                            }
                        }).join('');

                        item.innerHTML = `
                            <h3 onclick="toggleMovements(${index})">${row[0]}</h3>
                            <div id="movements-${index}" style="display: none;">
                                ${movementsHTML}
                            </div>
                            <img src="${row[3]}" alt="Album Art" width="150">
                            <p>Producers: ${row[4]}</p>
                            <a href="${row[1]}" target="_blank">View Leaflet</a>
                        `;

                        musicList.appendChild(item);
                    });
                })
                .catch(error => {
                    console.error('Error fetching music:', error);
                });
        }

        // Function to search through music by CD name
        function searchMusic() {
            const searchQuery = document.getElementById("search").value.toLowerCase();
            const items = document.getElementsByClassName('music-item');
            Array.from(items).forEach(item => {
                const title = item.getElementsByTagName('h3')[0].textContent.toLowerCase();
                item.style.display = title.includes(searchQuery) ? '' : 'none';
            });
        }

        // Display music when the page loads
        displayMusic();
    </script>
</body>
</html>
