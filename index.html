<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The CDStore ðŸ’¿</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
        #search { width: 50%; padding: 10px; margin: 10px auto; }
        .music-item { 
            margin: 15px auto; 
            padding: 15px; 
            border: 1px solid #ccc; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            max-width: 1000px;
        }
        .album-art { 
            width: 100px; 
            height: 100px; 
            object-fit: cover; 
            margin-right: 10px;
        }
        .album-art-large { 
            width: 150px; 
            height: 150px; 
            object-fit: cover; 
            margin-bottom: 15px;
        }
        .music-info { 
            text-align: left;
            width: 100%;
            margin-left: 20px;
        }
        .disc { 
            display: flex;
            align-items: center;
            margin: 10px 0; 
            cursor: pointer; 
            font-weight: bold;
            padding: 5px;
            background-color: #f1f1f1;
            border-radius: 5px;
            width: 100%;
            justify-content: flex-start;
        }
        .movements { 
            margin-top: 10px;
            display: none; 
            margin-bottom: 20px;
            width: 100%;
            text-align: left;
        }
        .movement-item {
            display: flex; 
            align-items: center;
            margin-bottom: 15px;
        }
        .movement-item audio {
            margin-left: 15px;
            width: 80%; 
        }
        .movement-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
        }
        #player-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            background-color: #f1f1f1;
            width: 100%;
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
        }
        #current-song {
            margin-bottom: 10px;
            font-size: 18px;
        }
        .seek-bar {
            width: 100%;
            max-width: 400px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Welcome to The CDStore ðŸ’¿</h1>
    <input type="text" id="search" placeholder="Search by CD name or movement..." onkeyup="searchMusic()">
    <div id="musicList"></div>

    <div id="player-container">
        <div id="current-song">No song playing</div>
        <audio id="audio-player" controls style="width: 80%; max-width: 400px;">
            <source id="audio-source" src="" type="audio/mp3">
            Your browser does not support the audio element.
        </audio>
        <input type="range" id="seek-bar" class="seek-bar" value="0" step="1" min="0" max="100">
    </div>

    <script>
        const jsonUrl = 'https://cors-anywhere.herokuapp.com/https://pastebin.com/raw/BZDRShrz';

        let currentAudio = null;

        function displayMusic() {
            fetch(jsonUrl, {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',  
                }
            })
            .then(response => response.json())
            .then(data => {
                const musicList = document.getElementById("musicList");
                musicList.innerHTML = '';

                if (data && Array.isArray(data)) {
                    data.forEach(row => {
                        const item = document.createElement('div');
                        item.classList.add('music-item');

                        const discName = row.cd_title;
                        const albumArt = row.album_art_url;

                        const discSection = document.createElement('div');
                        discSection.classList.add('disc');
                        discSection.innerHTML = `
                            <img class="album-art" src="${albumArt}" alt="Album Art">
                            ${discName}
                        `;

                        const movementsContainer = document.createElement('div');
                        movementsContainer.classList.add('movements');

                        row.movements.forEach(movement => {
                            const movementTitle = movement.movement_title;
                            const mp3Urls = movement.mp3_urls;

                            mp3Urls.forEach(mp3Url => {
                                const movementItem = document.createElement('div');
                                movementItem.classList.add('movement-item');
                                movementItem.innerHTML = `
                                    <img class="album-art-large" src="${albumArt}" alt="Album Art">
                                    <div class="movement-info">
                                        <h4 style="margin-left: 20px;">${movementTitle}</h4>
                                        <audio class="movement-audio">
                                            <source src="${mp3Url}" type="audio/mp3">
                                            Your browser does not support the audio element.
                                        </audio>
                                    </div>
                                `;
                                movementsContainer.appendChild(movementItem);

                                // Remove audio controls from the expandable list
                                const movementAudio = movementItem.querySelector('.movement-audio');
                                movementAudio.removeAttribute('controls');
                                movementAudio.addEventListener('play', () => {
                                    updateCurrentSong(movementTitle, mp3Url);
                                    setupSeekBar(movementAudio);
                                });
                            });
                        });

                        discSection.addEventListener('click', () => {
                            const isVisible = movementsContainer.style.display === 'block';
                            movementsContainer.style.display = isVisible ? 'none' : 'block';
                        });

                        item.appendChild(discSection);
                        item.appendChild(movementsContainer);
                        musicList.appendChild(item);
                    });
                }
            })
            .catch(error => {
                console.error('Error fetching music:', error);
            });
        }

        function updateCurrentSong(title, src) {
            const currentSongText = document.getElementById('current-song');
            const audioPlayer = document.getElementById('audio-player');
            const audioSource = document.getElementById('audio-source');

            currentSongText.textContent = `Now Playing: ${title}`;
            audioSource.src = src;
            audioPlayer.load();
            audioPlayer.play();
        }

        function setupSeekBar(audio) {
            const seekBar = document.getElementById('seek-bar');

            audio.addEventListener('timeupdate', () => {
                const progress = (audio.currentTime / audio.duration) * 100;
                seekBar.value = progress;
            });

            seekBar.addEventListener('input', () => {
                const newTime = (seekBar.value / 100) * audio.duration;
                audio.currentTime = newTime;
            });
        }

        function searchMusic() {
            const query = document.getElementById("search").value.toLowerCase();
            const musicItems = document.querySelectorAll('.music-item');
            musicItems.forEach(item => {
                const title = item.querySelector('.disc').innerText.toLowerCase();
                item.style.display = title.includes(query) ? 'block' : 'none';
            });
        }

        displayMusic();
    </script>
</body>
</html>
